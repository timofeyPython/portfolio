<template>
  <div class="order">
    <h1 class="display-6 title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>
    <div class="forms" @submit.prevent="create" v-if="store.getBasketCount > 0">
      <hr />
      <form class="row g-3">
        <div class="col-md-6">
          <label for="validationDefault01" class="form-label">–ò–º—è</label>
          <input
            type="text"
            class="form-control"
            id="validationDefault01"
            placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è"
            v-model="name"
            required
          />
        </div>
        <div class="col-md-6">
          <label for="validationDefault02" class="form-label">–§–∞–º–∏–ª–∏—è</label>
          <input
            type="text"
            class="form-control"
            id="validationDefault02"
            placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É —Ñ–∞–º–∏–ª–∏—é"
            v-model="surname"
            required
          />
        </div>
        <div class="col-md-6">
          <label for="validationTextarea" class="form-label">–í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω</label>
          <input
            v-model="phone"
            class="form-control"
            id="validationTextarea"
            placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"
            type="number"
            required
          />
        </div>
        <div class="col-md-6">
          <label for="exampleInputEmail1" class="form-label"
            >–ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã</label
          >
          <input
            type="email"
            class="form-control"
            id="exampleInputEmail1"
            aria-describedby="emailHelp"
            placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
            v-model="email"
          />
        </div>

        <div class="col-12">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              v-model="delivery"
              id="invalidCheck2"
            />
            <label class="form-check-label" for="invalidCheck2">
              –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç–∞–≤–∫–∞ (–û—Ç 590—Ä –ø–æ –≥–æ—Ä–æ–¥—É 27—Ä - –∑–∞ 1 –∫–º, –∑–∞ –≥–æ—Ä–æ–¥)
            </label>
          </div>
        </div>
        <div class="col-md-6" v-show="delivery">
          <label for="validationDefault03" class="form-label"
            >–ê–¥—Ä–µ—Å—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label
          >
          <input
            v-model="address"
            type="text"
            class="form-control"
            id="validationDefault03"
            :required="delivery ? true : false"
          />
        </div>

        <div class="col-12">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              v-model="montage"
              id="invalidCheck3"
            />
            <label class="form-check-label" for="invalidCheck3">
              üî® –ú–æ–Ω—Ç–∞–∂ 20% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞ (–ù–æ –Ω–µ –º–µ–Ω–µ–µ 900—Ä)
            </label>
          </div>
        </div>

        <div class="mb-3">
          <label for="exampleInputComments" class="form-label"
            >–ö–æ–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∑–∞–∫–∞–∑—É</label
          >
          <textarea
            class="form"
            placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
            style="width: 100%; padding: 8px"
            id="exampleInputComments"
            v-model="comments"
          ></textarea>
        </div>
        <hr />
        <h5>–í–∞—à –∑–∞–∫–∞–∑</h5>
        <div style="border: 1px solid gray; padding: 5%">
          <div class="row g-0" v-for="entry in store.basket" :key="entry.id">
            <div>
              <table class="table table-bordered" style="margin: 2% 1% 1% 1%">
                <tbody>
                  <tr>
                    <td colspan="2" class="td-special">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ö–∞—Ä-–∫–∏</td>
                  </tr>
                  <tr>
                    <td>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</td>
                    <td>{{ entry.name }}</td>
                  </tr>
                  <tr>
                    <td>–¢–∏–ø —Ä–∞–º—ã</td>
                    <td>{{ entry.types.material?.name }}</td>
                  </tr>
                  <tr>
                    <td>–¢–∏–ø –ø–æ–¥—Å–≤–µ—Ç–∫–∏</td>
                    <td>{{ entry.types.lighting.name }}</td>
                  </tr>
                  <tr>
                    <td>–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏</td>
                    <td>{{ entry.locationLighting }}</td>
                  </tr>
                  <tr>
                    <td>–ö–æ–ª–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–º–ø–æ—á–µ–∫</td>
                    <td>{{ entry.numberLight }}</td>
                  </tr>
                  <tr>
                    <td>–¢–∏–ø –∫—Ä–µ–ø–ª–µ–Ω–∏—è</td>
                    <td>{{ entry.typeFixation }}</td>
                  </tr>
                  <tr>
                    <td>–¢–æ–ª—â–∏–Ω–∞ –∑–µ—Ä–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª–æ—Ç–Ω–∞</td>
                    <td>{{ entry.depthMirror }} –º–º</td>
                  </tr>
                  <tr>
                    <td>–û–±—â–∞—è —Ç–æ–ª—â–∏–Ω–∞ –∏–∑–¥–µ–ª–∏—è</td>
                    <td>{{ entry.generalDepthProduction }} –º–º</td>
                  </tr>
                  <tr v-if="entry?.types.material?.name != '–ë–µ–∑ —Ä–∞–º—ã'">
                    <td>–®–∏—Ä–∏–Ω–∞ —Ä–∞–º—ã</td>
                    <td>{{ entry?.widthFrame }} –º–º</td>
                  </tr>
                  <tr>
                    <td colspan="2" class="td-special">–ò–∑–º–µ–Ω—è–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</td>
                  </tr>
                  <tr>
                    <td>–®–∏—Ä–∏–Ω–∞</td>
                    <td>{{ entry.width }} –º–º</td>
                  </tr>
                  <tr>
                    <td>–í—ã—Å–æ—Ç–∞</td>
                    <td>{{ entry.height }} –º–º</td>
                  </tr>
                  <tr>
                    <td>–¶–≤–µ—Ç–æ–≤–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</td>
                    <td>{{ entry.types.colorTemperature?.name }}</td>
                  </tr>
                  <tr v-if="entry?.types.material?.name != '–ë–µ–∑ —Ä–∞–º—ã'">
                    <td>–¶–≤–µ—Ç —Ä–∞–º—ã</td>
                    <td>{{ entry.types.frame.name }}</td>
                  </tr>
                  <tr v-if="entry?.types?.antiFogging">
                    <td>–ê–Ω—Ç–∏–∑–∞–ø–æ—Ç–µ–≤–∞–Ω–∏–µ</td>
                    <td>–ü—Ä–∏—Å—É—Ç—Å–≤—É–µ—Ç</td>
                  </tr>
                  <tr>
                    <td>–¶–µ–Ω–∞</td>
                    <td>{{ entry.price }} ‚ÇΩ</td>
                  </tr>
                  <tr v-if="entry.changeTypes">
                    <td colspan="2" style="font-weight: 500">
                      –í—ã –≤—ã–±—Ä–∞–ª–∏ –Ω–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —Ç–æ–≤–∞—Ä–∞, —Ç–æ—á–Ω–∞—è —Ü–µ–Ω–∞
                      –±—É–¥–µ—Ç –ø–æ–¥—Å—á–∏—Ç–∞–Ω–∞ –ø–æ—Å–ª–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞!
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div
          class="mb-3"
          style="display: flex; justify-content: space-between; margin-top: 5%"
        >
          <div>
            <h1 class="display-6 title">
              –°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ —Å–æ—Å—Ç–æ–≤–ª—è–µ—Ç:
              {{ store.getBasketSum }} ‚ÇΩ
            </h1>
          </div>
          <div>
            <button
              class="btn btn-outline-dark"
              style="border-radius: 0px"
              type="submit"
            >
              –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
            </button>
          </div>
        </div>
      </form>
    </div>

    <div v-else-if="store.getBasketCount === 0 && !status">
      <div class="emtpy">
        <div style="padding: 5px; display: flex">
          <div class="h4 mb-1" style="color: rgb(175, 9, 9)">
            <b-icon-basket3-fill />
          </div>
          <div style="margin-left: 15px; margin-top: 2px">
            –ù–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω—É
          </div>
        </div>
      </div>
      <div style="margin-top: 25px">
        <a href="/">
          <button class="btn btn-outline-dark">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–∞–≥–∞–∑–∏–Ω</button>
        </a>
      </div>
    </div>
    <div v-if="status">
      <div class="emtpy">
        <div style="padding: 5px; display: flex">
          <div class="h4 mb-1" style="color: green">
            <b-icon-basket3-fill />
          </div>
          <div style="margin-left: 15px; margin-top: 2px">
            –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω, —Å–ø–∞—Å–∏–±–æ, —á—Ç–æ –≤—ã–±—Ä–∞–ª–∏ –Ω–∞—Å !<br />
            –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è —Å –≤–∞–º–∏ —Å–≤—è–∂–∏—Ç—å—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞<br />
          </div>
        </div>
      </div>
      <div style="margin-top: 25px">
        <a href="/">
          <button class="btn btn-outline-dark">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–∞–≥–∞–∑–∏–Ω</button>
        </a>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import useStore from "@/store/useStore";
import { createOrder } from "@/utils/api";
import { ref } from "vue";

const store = useStore();
const name = ref("");
const surname = ref("");
const phone = ref("");
const email = ref("");
const comments = ref("");
const address = ref("");
const delivery = ref(false);
const montage = ref(false);
const status = ref(false);

const create = async () => {
  const order = {
    products: store.basket,
    price: store.getBasketSum,
    name: name.value,
    surname: surname.value,
    phone: phone.value,
    email: email.value,
    address: address.value,
    montage: montage.value,
    delivery: delivery.value,
    comments: comments.value,
  };

  const res = await createOrder(order);
  if (res) {
    store.clearBasket();
    status.value = true;
  }
};
</script>

<style scoped lang="scss" src="../styles/order.scss"></style>
